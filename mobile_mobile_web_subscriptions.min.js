class MobileWebSubscriptions{constructor(a,c,b,e){this.os=a;this.storeLink=c;this.hasUdid=b;this.isSubscribed=e;this.requestUrl=window.location.href;this.googleSupported=!0;"iOS"===a&&(document.addEventListener("AppleIDSignInOnSuccess",d=>{this.handleSignInWithApple(d.detail.authorization,d.detail.user)}),document.addEventListener("AppleIDSignInOnFailure",d=>{"popup_closed_by_user"!==d.detail.error&&(console.log(d.detail.error),this.showError(i18n("COULD_NOT_AUTHORIZE_SIGN_IN_WITH_APPLE")))}),AppleID.auth.init({clientId:"com.symbolab.www",
scope:"email name",redirectURI:window.location.origin,state:'""',nonce:"",usePopup:!0}));$(document).ready(()=>{if(0<=window.location.hash.indexOf("checksubscribed")){const d=window.location.href.replace(/#.*/,"");window.history.replaceState({},document.title,d);this.isSubscribed||showSubscription(baseReason+"\tSignedIn")}$("#one-tap-container").on("click",function(d){$(this).is($(d.target))&&$(this).hide()});$(".sign-in-close-button").on("click",function(){$("#one-tap-container").hide()});$(".store-logo").on("click",
()=>{$.when(symbolab_log("Registration","OpenStore",baseReason+"StoreIcon")).always(()=>{this.goToStore()})});$("#avatar").click(()=>{let d=baseReason+"\tAvatarClick";this.hasUdid?this.isSubscribed?window.location.href="/user?url="+encodeURIComponent(window.location.pathname):showSubscription(d):this.showGoogleSignIn(d);return!1});$(".lazy-loading").each(function(){const d=$(this).data("src");$(this).attr("src",d)})})}finalAction(a,c){window.location.href===a?void 0!==c&&(a=0>a.indexOf("#")?a+"#":
a+"&",window.location=a+c):(void 0!==c&&(a=0>a.indexOf("#")?a+"#":a+"&",a+=c),window.location=a);window.location.reload()}showError(a){alertify.okBtn("OK").alert(a)}handleSignInWithApple(a,c){void 0===this.requestUrl&&(onerror("Trace: null requestUrl","https://symbolab.com/mobile_web_subscriptions.html",192,0,Error("requestUrl was undefined")),this.requestUrl=window.location.href);let b=(new URL(this.requestUrl)).origin;$.ajax({type:"POST",url:"/appleMobileAuth",beforeSend:authorizeAjaxWithSyToken,
data:{code:a.code,idToken:a.id_token,registrationReason,remember:!1,redirect:b,userInfo:c}}).done(e=>{e.success||e.jwt?e.subscribed?this.finalAction(b,"checksubscribed"):showSubscription(baseReason+"\tSignedIn"):this.showError(e.alert)}).fail(e=>{this.showError(e.responseText)})}logGoogleMomentNotification(a){a.isNotDisplayed()&&(this.googleSupported=!1)}handleGoogleTokenMobile(a){let c=this.requestUrl;$.ajax({type:"POST",url:"/googleMobileAuth",beforeSend:authorizeAjaxWithSyToken,data:{idRequestToken:a.credential,
registrationReason,remember:!1,redirect:this.requestUrl}}).done(b=>{b.success||b.jwt?b.subscribed?this.finalAction(c,"checksubscribed"):showSubscription(baseReason+"\tSignedIn"):this.showError(b.alert)}).fail(b=>{this.showError(b.responseText)})}showGoogleSignIn(a,c){void 0===c&&(c=!1);this.googleSupported?("undefined"!==typeof logFunnel2?logFunnel2("ShowSignUp",a):symbolab_log("Registration","ShowSignUp",a),c?$("#one-tap-container").addClass("from-steps").show():$("#one-tap-container").removeClass("from-steps").show(),
$("#one-tap-container .free-app-sticker > a").off("click").on("click",b=>{b.preventDefault();$.when(symbolab_log("Registration","OpenStore",a)).always(()=>{this.goToStore()})})):this.showMobileAppDownload(a+"\tGoogleSignInNotSupported",i18n("js.mobile_input_box_click"))}showMobileAppDownload(a,c){symbolab_log("Registration","ClickedFeature",a);const b=$("#store-prompt");b.find("#close-btn").off("click").on("click",function(e){e.preventDefault();b.addClass("hide-important")});b.find("span").html(c);
b.find("#store-logo-link").off("click").on("click",e=>{e.preventDefault();b.addClass("hide-important");$.when(symbolab_log("Registration","OpenStore",a)).always(()=>{this.goToStore()})});b.removeClass("hide-important")}goToStore(){window.location=this.storeLink}};
